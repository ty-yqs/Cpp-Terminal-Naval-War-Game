# 终端海战小游戏（ncurses）

这是一个运行在终端里的实时动作小游戏：你操控玩家飞船在障碍地图中移动并开火，击毁敌舰赚取金币，达成关卡金币目标后进入下一关。

## 环境与依赖

- C++17
- `ncurses`（终端绘制与键盘输入）

## 编译与运行

在项目根目录：

```bash
make
```

运行（随机障碍地图）：

```bash
./game
```

运行（加载地图文件，如 `map.txt`）：

```bash
./game map.txt
```

清理：

```bash
make clean
```

## 游戏目标 / 通关条件

- 游戏共两关：
  - 第 1 关：`Coins >= 100` 自动进入第 2 关，并将金币清零重新开始累计
  - 第 2 关：`Coins >= 200` 视为通关（游戏结束）
- 失败条件：玩家 `HP <= 0`（游戏结束）

金币主要通过击毁敌舰获得（见“敌人”）。

## 玩法与机制

### 基本循环

- 每帧：读取输入 → 更新玩家/敌人/投射物 → 碰撞检测 → 渲染
- 屏幕上方 HUD 会显示：关卡 `Lv`、生命 `HP`、金币 `Coins`、炮弹 `Shells`、导弹 `Missiles`

### 移动与障碍

- 地图中的 `#` 为障碍：
  - 玩家不可穿过
  - **除 Bomber 外的所有敌人**不可穿过
  - 投射物（炮弹/鱼雷/导弹）碰到障碍会被销毁
  - Bomber 允许穿过障碍（特例）

### 开火方向规则

- “当前正在移动”时：使用本次方向作为开火方向
- “静止”时：使用上一次移动方向；如果从未移动过，默认向上

### 武器机制

- `Space`：发射普通炮弹（Shell），沿开火方向直线飞行
- `A`：向“当前移动方向”的左侧发射三发**平行**炮弹（消耗 3 发 Shell）
- `D`：向“当前移动方向”的右侧发射三发**平行**炮弹（消耗 3 发 Shell）
- `U`：发射导弹（Missile），初始朝开火方向直线飞行（敌方巡洋舰的导弹为追踪导弹）

投射物出生点会从船体“朝该方向的最前沿”外侧生成，避免自伤。

### 道具

道具会随机刷新（不会刷在障碍上）。玩家在以自己为中心的 3×3 范围内靠近即可拾取：

- `W`（武器补给）：`Shells +20`，`Missiles +1`
- `+`（医疗）：`HP +100`（不超过最大生命值）

## 操作说明（键盘）

- 移动：方向键 `↑ ↓ ← →`
- 发射炮弹（Shell）：空格 `Space`
- 左侧三连发：`A` / `a`
- 右侧三连发：`D` / `d`
- 发射导弹（Missile）：`U` / `u`
- 退出：`Q` / `q`

## 角色与数值

### 玩家（绿色）

- 外形：
  - 竖向移动时为 3 行：` ^` / ` "` / ` V`
  - 横向移动时为 1 行：`<=>`
- 初始：`HP = 1000`，`Shells = 100`，`Missiles = 5`
- 自动补给：炮弹会随时间缓慢回复；导弹回复更慢

### 敌人

- Gunboat（黄色，`o`）
  - HP：1
  - 行为：向玩家方向开火
  - 金币：0

- Destroyer（红色，`O`）
  - HP：10
  - 行为：向玩家方向开火；并左右各发射一枚鱼雷
  - 金币：+1

- Cruiser（紫色，`<>`）
  - HP：100
  - 行为：向上下左右四方向同时开火；并发射追踪导弹
  - 金币：+10

- Bomber（青色，3 行飞机造型）
  - 特性：无敌（不会被炮弹击毁）
  - 行为：水平飞行；会投放鱼雷或向下发射多发子弹
  - 例外：允许穿过障碍

## 投射物（子弹/鱼雷/导弹）

- Shell（炮弹）：伤害 1
  - 显示：竖向 `|`，横向 `-`
- Torpedo（鱼雷）：伤害 10
  - 显示：`=`
- Missile（导弹）：伤害 5
  - 显示：`*`
  - 追踪：只有被设置目标的导弹会追踪（例如 Cruiser 发射的导弹）
  - 寿命：追踪导弹有步数上限，避免无限追踪

## 地图文件说明

加载地图（如 `map.txt`）时：

- `#` / `1` / `X`（大小写均可）会被当作障碍
- `.` / `0` 会被当作空地

玩家出生在靠近底部中间的位置，出生点附近会清出一小块区域以避免开局卡死。

地图文件示例：

```
................................................................................
................................................................................
................................................................................
................................................................................
................................................................................
..........###########..............................###########..................
..........###########..............................###########..................
..........###########..............................###########..................
................................................................................
....................#######.....................................................
....................#######...............######................................
....................#######...............######................................
.........................................######.................................
..............####....................................................#####.....
..............####....................##########......................#####.....
..............####....................##########......................#####.....
......................................##########................................
....................#####.......................................................
....................#####.....................#####.............................
....................#####.....................#####.............................
................................................................................
...........####################.................................................
...........####################..............#########..........................
...........####################..............#########..........................
...........####################..............#########..........................
................................................................................
................................................................................
................................................................................
................................................................................
................................................................................
```
