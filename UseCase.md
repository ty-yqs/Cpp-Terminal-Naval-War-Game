# Use Case

## Name
皇家海空大战终端游戏

## Brief Description
玩家在终端中启动海战游戏，可选择通过命令行参数指定障碍地图文件路径（`./game <map文件路径>`）。系统初始化世界与玩家单位，进入游戏循环，持续处理玩家输入、更新实体与渲染画面。玩家通过战斗与拾取道具获取金币并推进关卡，玩家生命值归零则失败结束，达到关卡金币目标则进入下一关或胜利结束。

## Actors
- 玩家（Human Player）

## Preconditions
- 运行环境支持 `ncurses`，可执行文件 `game` 已编译完成。
- 玩家在可读写的终端会话中运行程序。
- 若指定地图路径：该路径指向一个可读取的文本文件（格式见“异常流程/替代流程”）。

## Basic Flow
1. 玩家在命令行执行 `./game <map文件路径>` 或 `./game`。
2. 系统启动游戏：
   - 若提供 `<map文件路径>`，尝试从该文件加载障碍地图；
   - 若未提供参数，则随机生成障碍地图。
3. 系统创建玩家单位，并进入主循环（输入→更新→渲染）。
4. 玩家进行移动与射击操作（如发射炮弹/散射/导弹），系统根据输入更新玩家状态。
5. 系统按规则生成敌人和道具，更新敌人 AI、投射物移动与碰撞检测。
6. 若玩家拾取道具，系统给予弹药补给或回复生命值，并移除对应道具。
7. 系统在 HUD 中持续显示关卡、生命值、金币与弹药信息。
8. 当玩家金币达到第 1 关目标时，系统切换到第 2 关：清理敌人/投射物/掉落并重新生成（或加载）地图，随后继续游戏循环。
9. 当玩家金币达到第 2 关目标时，系统判定胜利并退出游戏循环。

## Alternate Flows
A1（不指定地图参数）
- 在步骤 1，玩家执行 `./game`。
- 在步骤 2，系统跳过文件读取，直接随机生成障碍地图，然后按基本流程继续。

A2（指定地图但加载失败后回退随机）
- 在步骤 2，系统尝试读取 `<map文件路径>`。
- 若地图文件不存在/不可读/内容无效，系统回退为随机生成障碍地图，然后按基本流程继续。

A3（关卡切换时地图策略保持一致）
- 在步骤 8：
  - 若玩家启动时指定了地图文件，则每次关卡重置时系统再次从该文件加载地图；
  - 若未指定地图文件，则每次关卡重置时系统重新随机生成地图。

## Exception Flows
E1（地图文件路径非法或无权限）
- 触发条件：`./game <map文件路径>` 但文件不存在、路径错误或无读取权限。
- 系统处理：视为加载失败，回退到随机生成地图并继续游戏（不崩溃）。

E2（地图文件格式不符合要求）
- 触发条件：地图文件内容为空或无法解析为有效网格。
- 系统处理：视为加载失败，回退到随机生成地图并继续游戏。
- 备注（当前实现约束）：地图建议为 30 行，每行最多 80 个格子字符；`#`/`1`/`X` 表示障碍，`.`/`0` 表示空地（空格/Tab 会被忽略）。

E3（玩家生命值归零）
- 触发条件：战斗中玩家受到伤害导致 HP ≤ 0。
- 系统处理：系统结束游戏循环并退出（失败结束）。

## Post Conditions
- 游戏进程结束（胜利或失败），主循环退出。
- 若胜利：玩家金币达到最终关卡目标；若失败：玩家 HP ≤ 0。
- 程序正常返回到命令行（无未处理异常导致崩溃）。
